/* Author: Drew Chase */
async function buildAddAppOptionsFromTemplate(e){const o=await getTemplateJson(e),t=$("dialog#add-item-modal #template-options");t.html(""),t.append($(`<h2>${o.name}</h2>`)),t.append($(`<p style="text-align: center; font-size: 1.5rem; margin-top: 10px; margin-bottom: 1rem;">${o.description}</p>`));for(const e of o.options){const n=e.name.toLowerCase().replace(/[^a-z]/g,"-");let l;switch(console.log(n),e.type){case"select":if(e.populated_from_url){var a=e.populated_from_url;if(a.includes("{")){const o=/{([^}]+)}/g,t=[...a.matchAll(o)];for(const e of t){const o=e[1],t=$(`dialog#add-item-modal #template-options [label="${o}"]`);t.on("change",async()=>{const o=t.val();let n=a.replace(e[0],encodeURIComponent(o));console.log(n);const i=await $.ajax({url:n,method:"GET",dataType:"json",beforeSend:()=>{startLoading()},complete:()=>{stopLoading()},success:e=>(console.log(e),e),error:(e,o,t)=>(console.log(t),alert(`Error: ${t}`),null)});console.log(l.options),l.options=i.map(e=>new DropdownOption(e,e,!1)),l.rerender()})}(l=new Dropdown(e.name,[])).title=e.description;break}const o=await $.ajax({url:a,method:"GET",dataType:"json",beforeSend:()=>{startLoading()},complete:()=>{stopLoading()},success:e=>(console.log(e),e),error:(e,o,t)=>(console.log(t),alert(`Error: ${t}`),null)});(l=new Dropdown(e.name,o.map(e=>new DropdownOption(e,e,!1)))).title=e.description;break}const t=e.options.map(o=>new DropdownOption(o.name,o.value,o.value==e.default));(l=new Dropdown(e.name,t)).title=e.description;break;case"boolean":(l=new Toggle(e.name,e.default)).title=e.description;const i=o.options.filter(o=>o.condition&&o.condition==e.name),p=e=>{e?i.forEach(e=>{const o=e.element;o&&$(o).css("display","block")}):i.forEach(e=>{const o=e.element;o&&$(o).css("display","none")})};$(l).on("toggle",(e,o)=>{p(o.value)}),$(document).on("finish-building-options",()=>{p(l.value)});break;case"text":l=$(`<div class="floating-input col" id="${n}"></div>`);const d=$(`<label for="${e.name}">${e.name}</label>`),r=$(`<input type="text" placeholder="${e.description}" name="${e.name}" value="${e.default}">`);r.title=e.description,l.append(r),l.append(d);break;case"number":l=$('<div class="floating-input col"></div>');const s=$(`<label for="${e.name}">${e.name}</label>`),c=$(`<input type="number" placeholder="${e.description}" name="${e.name}" value="${e.default}">`);c.title=e.description,l.append(c),l.append(s);break;case"color":l=$('<div class="color-input center vertical row"></div>');const m=$(`<label for="${e.name}" class='fill'>${e.name}</label>`),u=$(`<input type="color" placeholder="${e.description}" name="${e.name}" value="${e.default}">`);l.attr("title",e.description),l.append(m),l.append(u);break;case"date":l=$('<div class="floating-input col"></div>');const f=$(`<label for="${e.name}">${e.name}</label>`),g=$(`<input type="date" placeholder="${e.description}" name="${e.name}" value="${e.default}">`);g.title=e.description,l.append(g),l.append(f);break;case"time":l=$('<div class="floating-input col"></div>');const b=$(`<label for="${e.name}">${e.name}</label>`),v=$(`<input type="time" placeholder="${e.description}" name="${e.name}" value="${e.default}">`);v.title=e.description,l.append(v),l.append(b);break;case"datetime":l=$('<div class="floating-input col"></div>');const w=$(`<label for="${e.name}">${e.name}</label>`),y=$(`<input type="datetime-local" placeholder="${e.description}" name="${e.name}" value="${e.default}">`);y.title=e.description,l.append(y),l.append(w);break;case"textarea":l=$('<div class="floating-input col"></div>');const h=$(`<label for="${e.name}">${e.name}</label>`),j=$(`<textarea type="text" placeholder="${e.description}" name="${e.name}">${e.default}</textarea>`);j.title=e.description,l.append(j),l.append(h);break;case"file":l=$(`<file-input name="${e.name}" description="${e.description}" extensions="${e.extensions.join(",")}" multiple="${e.multiple}" default="${e.default}"></file-input>`);break;case"array":l=$(`<array-input name="${e.name}" description="${e.description}" default="${e.default.join(",")}"></array-input>`)}e.element=l,t.append(l)}t.append($("<div class='row center vertical fill' style='margin-top: 1rem;'><button id='add-item' type='submit' style='margin: auto;width: 200px;'>Add</button></div>")),$(document).trigger("finish-building-options")}async function getTemplateJson(e){return await $.ajax({url:`/templates/${e}/template.json`,method:"GET",dataType:"json",beforeSend:()=>{startLoading()},complete:()=>{stopLoading()},success:e=>e,error:(e,o,t)=>(console.log(t),alert(`Error: ${t}`),null)})}import Dropdown from"./doms/Dropdown.js";import Toggle from"./doms/Toggle.js";import DropdownOption from"./doms/DropdownOption.js";import ArrayInput from"./doms/ArrayItem.js";import FileInput from"./doms/FileInput.js";$("dialog#add-item-modal drop-down#template").on("change",(e,o)=>{buildAddAppOptionsFromTemplate(o.value)}),$("dialog#add-item-modal drop-down#template dropdown-option")[1].click();